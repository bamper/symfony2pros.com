{% extends "ProtonQnABundle::layout.html.twig" %}

{% block title %}Question - {{ question.title }}{% endblock %}

{% from "ProtonUserBundle::macros.html.twig" import placard %}
{% from "ProtonCoreBundle::macros.html.twig" import time_formatter %}

{% block content %}
<div id="question-meta" class="well">
    <h1>{{ question.title }}</h1>
    {{ placard(question.author) }}
    <p>{{ time_formatter(question.createdat, 'Asked') }}</p>
{% set views = question.views %}
    <p>{% transchoice views %}
        {0} 0 views|{1} 1 view|]1,Inf] %views% views
    {% endtranschoice %}</p>
    <p>
{% if canEdit %}
        <a class="btn" data-controls-modal="edit-modal" data-keyboard="true" data-backdrop="static" >Edit</a>
{% endif %}
{% if is_granted('ROLE_ADMIN') %}
        <a class="btn danger" href="{{ path('proton_qna_questions_delete', {'id': question.id}) }}">Trash</a>
{% endif %}
    </p>
</div>
{{ question.content|markdown }}

<hr />

<div id="answers-list">
{% set count = question.answers|length %}
    <h1>{% transchoice count %}
        {0} 0 Answers|{1} 1 Answer|]1,Inf] %count% Answers
{% endtranschoice %}</h1>
{% for answer in question.answers %}
    <div id="answer-{{ answer.id }}" class="answer answer-{{ answer.id }}">
        {{ placard(answer.author) }}
        <p>{{ time_formatter(answer.createdat, 'Answered') }}</p>
        {{ answer.content|markdown }}
    </div>
{% endfor %}
{% if canAnswer %}
        {% render "ProtonQnABundle:Answer:new" with {'question': question} %}
{% endif %}
</div>

{% if canEdit %}
<div id="edit-modal" class="modal hide fade">
    <div class="modal-header">
        <h3>Editing "{{ question.title }}"</h3>
    </div>
    <div class="modal-body">
        {% render "ProtonQnABundle:Question:edit" with {'question': question} %}
    </div>
    <div class="modal-footer">
        <a class="btn primary" href="">Submit</a>
        <a class="btn secondary" href="">Cancel</a>
    </div>
</div>

<script type="text/javascript">
$('#edit-modal a.primary').bind('click', function(e){
    e.preventDefault();
    $('#question-edit-form').submit();
});
</script>
{% endif %}
{% endblock %}